stages:
  - lint
  - build
  - test
  - publish

# -----------------------------
# SHELL SCRIPTS (.sh) LINTING
# -----------------------------
shellcheck:
  image: koalaman/shellcheck
  stage: lint
  script: shellcheck **/*.sh
  rules:
    - exists:
        - '*.sh'

# -----------------------------
# YAML LINTING
# -----------------------------
yamllint:
  image: cytopia/yamllint
  stage: lint
  script: yamllint .
  rules:
    - exists:
        - '*.yml'
        - '*.yaml'

# -----------------------------
# C PROJECT
# -----------------------------
c_build:
  image: gcc:latest
  stage: build
  script:
    - make
  rules:
    - exists:
        - 'Makefile'

c_test:
  image: gcc:latest
  stage: test
  script:
    - make test || echo "no tests defined"
  rules:
    - exists:
        - 'Makefile'

# -----------------------------
# .NET (Console, Web, Aspire)
# -----------------------------
dotnet_build:
  image: mcr.microsoft.com/dotnet/sdk:8.0
  stage: build
  script:
    - dotnet restore
    - dotnet build --configuration Release
  rules:
    - exists:
        - '*.csproj'
        - '*.sln'

dotnet_test:
  image: mcr.microsoft.com/dotnet/sdk:8.0
  stage: test
  script:
    - dotnet test --no-build
  rules:
    - exists:
        - '*.csproj'
        - '*.sln'

dotnet_publish:
  image: mcr.microsoft.com/dotnet/sdk:8.0
  stage: publish
  script:
    - dotnet publish --configuration Release -o publish
  rules:
    - exists:
        - '*.csproj'
        - '*.sln'
  artifacts:
    paths:
      - publish/

